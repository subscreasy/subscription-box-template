<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>subscriptionBoxTemplate</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="assets/fonts/ionicons.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Actor">
    <link rel="stylesheet" href="assets/css/Bootstrap-Payment-Form.css">
    <link rel="stylesheet" href="assets/css/Footer-Dark.css">
    <link rel="stylesheet" href="assets/css/Login-Form-Clean.css">
    <link rel="stylesheet" href="assets/css/Navigation-with-Button.css">
    <link rel="stylesheet" href="assets/css/Pretty-Product-List.css">
    <link rel="stylesheet" href="assets/css/Product-Details.css">
    <link rel="stylesheet" href="assets/css/Profile-Card.css">
    <link rel="stylesheet" href="assets/css/Profile-Edit-Form-1.css">
    <link rel="stylesheet" href="assets/css/Profile-Edit-Form.css">
    <link rel="stylesheet" href="assets/css/Registration-Form-with-Photo.css">
    <link rel="stylesheet" href="assets/css/styles.css">
    <link rel="stylesheet" href="node_modules/toastr/build/toastr.css">

    <!-- external javascript-->
    <script src="bundle.js"></script>
    <script src="assets/js/custom.js"></script>
</head>

<body onload="bodyOnLoad();">
    <div>
        <nav class="navbar navbar-light navbar-expand-md fixed-top navigation-clean-button">
            <div class="container"><a class="navbar-brand" href="#">Company Name</a><button class="navbar-toggler" data-toggle="collapse" data-target="#navcol-1"><span class="sr-only">Toggle navigation</span><span class="navbar-toggler-icon"></span></button>
                <div class="collapse navbar-collapse"
                    id="navcol-1">
                    <ul class="nav navbar-nav mr-auto">
                        <li class="nav-item" role="presentation"><a class="nav-link active" href="#">First Item</a></li>
                        <li class="nav-item" role="presentation"><a class="nav-link" href="#">Second Item</a></li>
                        <li class="dropdown"><a class="dropdown-toggle nav-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false" href="#">Dropdown </a>
                            <div class="dropdown-menu" role="menu"><a class="dropdown-item" role="presentation" href="#">First Item</a><a class="dropdown-item" role="presentation" href="#">Second Item</a><a class="dropdown-item" role="presentation" href="#">Third Item</a></div>
                        </li>
                    </ul><span class="navbar-text" id="basketSpan" style="padding-left:0px;padding-right:10px;"><a href="#"><i class="fa fa-shopping-cart" style="font-size:30px;"></i></a></span><span class="navbar-text" id="profileSpan" style="padding-left:0px;padding-right:10px;"><a href="userProfile.html"><i class="fa fa-user" style="font-size:30px;"></i></a></span>
                    <span
                        class="navbar-text actions" id="loginSpan"> <a href="login.html" class="login">Log In</a><a class="btn btn-light action-button" role="button" href="signUp.html">Sign Up</a></span><span class="navbar-text" id="logoutSpan"><button class="btn btn-light" type="button" onclick="logout();">Logout</button></span>
                </div>
            </div>
        </nav>
    </div>
    <div class="container profile profile-view" id="profile" style="padding-top: 70px;">
        <form>
            <div class="form-row profile-row">
                <div class="col-md-4 relative">
                    <div class="p-3 text-center">
                        <img class="card-img-top rounded-circle" id="user-profile" src="assets/img/user.png" style="width: 120px; height: 120px;" />
                    </div>
                    <div class="custom-file">
                        <input type="file" class="custom-file-input" id="user-image" onchange="selectFile()" name="avatar-file">
                        <label class="custom-file-label" for="user-image">Choose file</label>
                    </div>
                    <div class="text-center" style="padding-top: 10px;">
                        <label id="upload-info" style="display: none;"><span id="upload-info-text"></span><span id="spinner-span" style="visibility: hidden;"><i class="fa fa-spinner fa-spin" style="font-size:24px"></i></span></label>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="form-row">
                        <div class="col-sm-12 col-md-6">
                            <div class="form-group"><label>Firstname </label><input class="form-control" type="text" name="firstname" autocomplete="given-name"></div>
                        </div>
                        <div class="col-sm-12 col-md-6">
                            <div class="form-group"><label>Lastname </label><input class="form-control" type="text" name="lastname" autocomplete="family-name"></div>
                        </div>
                    </div>
                    <div class="form-group"><label>Email </label><input class="form-control" type="email" autocomplete="email" required="" name="email" disabled="disabled"></div>
                    <div class="form-row">
                        <div class="col-sm-12 col-md-6">
                            <div class="form-group"><label>Password </label><input class="form-control" type="password" name="password" autocomplete="off"></div>
                        </div>
                        <div class="col-sm-12 col-md-6">
                            <div class="form-group"><label>Confirm Password</label><input class="form-control" type="password" name="confirmpass" autocomplete="off"></div>
                        </div>
                    </div>
                    <hr>
                    <div class="form-row">
                        <div class="col-md-12 content-left"><button class="btn btn-primary form-btn" onclick="userUpdate();" type="button">SAVE </button><button class="btn btn-danger form-btn" type="reset">CANCEL </button></div>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <div class="footer-dark">
        <footer>
            <div class="container">
                <div class="row">
                    <div class="col-sm-6 col-md-3 item">
                        <h3>Services</h3>
                        <ul>
                            <li><a href="#">Web design</a></li>
                            <li><a href="#">Development</a></li>
                            <li><a href="#">Hosting</a></li>
                        </ul>
                    </div>
                    <div class="col-sm-6 col-md-3 item">
                        <h3>About</h3>
                        <ul>
                            <li><a href="#">Company</a></li>
                            <li><a href="#">Team</a></li>
                            <li><a href="#">Careers</a></li>
                        </ul>
                    </div>
                    <div class="col-md-6 item text">
                        <h3>Company Name</h3>
                        <p>Praesent sed lobortis mi. Suspendisse vel placerat ligula. Vivamus ac sem lacus. Ut vehicula rhoncus elementum. Etiam quis tristique lectus. Aliquam in arcu eget velit pulvinar dictum vel in justo.</p>
                    </div>
                    <div class="col item social"><a href="#"><i class="icon ion-social-facebook"></i></a><a href="#"><i class="icon ion-social-twitter"></i></a><a href="#"><i class="icon ion-social-snapchat"></i></a><a href="#"><i class="icon ion-social-instagram"></i></a></div>
                </div>
                <p class="copyright">Company Name © 2017</p>
            </div>
        </footer>
    </div>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/bootstrap/js/bootstrap.min.js"></script>
    <script src="assets/js/Profile-Edit-Form.js"></script>
    <script src="node_modules/toastr/build/toastr.min.js"></script>
    <script type="text/javascript">
        if (!isLoggedInFunc()) {
            document.location.href = "login.html";
        }

        var jsonData = JSON.parse(localStorage.getItem("userProfile"));

        debugger;
        if (jsonData !== null) {
            $("[name='firstname']").val(jsonData.firstName);
            $("[name='lastname']").val(jsonData.lastName);
            $("[name='email']").val(jsonData.email);
            if (jsonData.imageUrl !== null) {
                $("#user-profile").attr("src", jsonData.imageUrl);
            }
        }

        function userUpdate() {
            authorization.apiKey = authorizationTokenFunc();
            var managedUserVM = managedUserFunc(jsonData.login, jsonData.password, $("[name='firstname']").val(), $("[name='lastname']").val(), jsonData.id, jsonData.langKey);
            var callback = function(error, data, response) {
                if (error) {
                    console.error(error);
                    toastr.warning("Profil bilgileriniz güncellenirken hata oluştu.");
                } else {
                    debugger;
                    localStorage.setItem('userProfile', JSON.stringify(data));
                    var updateData = JSON.parse(localStorage.getItem("userProfile"));
                    $("[name='firstname']").val(updateData.firstName);
                    $("[name='lastname']").val(updateData.lastName);
                    $("[name='email']").val(updateData.email);
                    toastr.success("Profil bilgileriniz güncellendi");
                }
            };
            userResourceApi.updateCurrentUserUsingPUT(managedUserVM, callback);
        }

        function selectFile() {
            debugger;
            authorization.apiKey = authorizationTokenFunc();
            var selectedFiles = document.getElementById('user-image').files;
            if (selectedFiles.length === 0) {
                $("#upload-info").css("display", "block");
                $("#upload-info-text").text("Resim seçilmedi.");
                return;
            }
            var currentFileUpload = selectedFiles[0];
            var imageSize = currentFileUpload.size / 1024 / 1024;
            if (imageSize > 1) {
                $("#upload-info").css("display", "block");
                $("#upload-info-text").text("Resim boyutu 1 MB tan büyük olamaz.");
                return;
            }
            $("#upload-info").css("display", "block");
            $("#upload-info-text").text("Resim yükleniyor...");
            $("#spinner-span").css('visibility', 'visible');
            var callback = function(error, data, response) {
                if (error) {
                    console.error(error);
                    $("#upload-info-text").text("Resim yükleme işlemi başarısız oldu.");
                } else {
                    var imageElement = $("#user-profile");
                    var timestamp = Number(new Date());
                    jsonData.imageUrl = data;
                    localStorage.setItem('userProfile', JSON.stringify(jsonData));
                    imageElement.attr("src", data + '?timestamp=' + timestamp);
                    $("#upload-info-text").text("Resim yüklendi.");
                    $("#spinner-span").css('visibility', 'hidden');
                }
            };
            userResourceApi.uploadFileUsingPOST1(currentFileUpload, jsonData.company.id, jsonData.id, callback);
        }
    </script>
</body>

</html>